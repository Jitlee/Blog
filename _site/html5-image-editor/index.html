<!DOCTYPE html>
<html lang="ch-cn">

	<head>
		<title>HTML5图片选剪裁择器</title>
		<meta charset="utf-8" /> 
		<meta name="description" content="给大家介绍一款基于HTML5+开发的一个头像剪裁组件"> 
		<meta name="author" content="Jitlee.Wan">

		<!-- Enable responsive viewport -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="http://jitlee.github.io/blog/assets/css/style.css">
		<link rel="stylesheet" type="text/css" href="http://jitlee.github.io/blog/assets/resources/syntax/syntax.css">
		<link rel="stylesheet" type="text/css" href="http://jitlee.github.io/blog/assets/resources/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="http://jitlee.github.io/blog/assets/resources/font-awesome/css/font-awesome.min.css">
		<link rel="shortcut icon" href="http://jitlee.github.io/blog/assets/ico/favicon.png">

		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script type="text/javascript" src="http://jitlee.github.io/blog/assets/resources/bootstrap/js/bootstrap.js"></script>

		<script type="text/javascript">
			$(document).ready(function(){
				if(window.location.href.replace(/\/$/g, "")=="http://jitlee.github.io/blog") {
					$("#sidebar").css({width:'100%'});
					$("#btnblog").click(function(){
						$("#sidebar").animate({width:'33.3333%'},'slow');
					});
				}
			});
		</script>
	</head>

	<body>
		<nav class="navbar navbar-default visible-xs" role="navigation">

			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbarHeaderCollapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				
				<a type="button" class="navbar-toggle nav-link" href="http://github.com/jitlee">
					<i class="fa fa-github"></i>
				</a>
				 
				<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/www.wpj@163.com">
					<i class="fa fa-qq"></i>
				</a>
				 
				<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/jitlee">
					<i class="fa fa-weibo"></i>
				</a>
				 
				<a type="button" class="navbar-toggle nav-link" href="mailto:www.wpj@163.com">
					<i class="fa fa-envelope"></i>
				</a>
				

				<a class="navbar-brand" href="http://jitlee.github.io/blog">
					<img src="http://jitlee.github.io/blog/jitlee.gif" class="img-circle img-circle-small"/> Jitlee-Wan
				</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="navbarHeaderCollapse">
				<ul class="nav navbar-nav">
					<li class="active"><a href="http://jitlee.github.io/blog">主页</a></li>
					<li><a href="http://jitlee.github.io/blog/categories.html">分类</a></li>
					<li><a href="http://jitlee.github.io/blog/tags.html">标签</a></li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->

		</nav>

		<!-- nav-menu-dropdown -->
		<div class="btn-group hidden-xs" id="nav-menu">
			<button type="button" class="btn btn-default dropdown-toggle pull-right" data-toggle="dropdown">
				<i class="fa fa-bars"></i>
			</button>
			<ul class="dropdown-menu pull-right" role="menu">
				<li><a href="http://jitlee.github.io/blog"><i class="fa fa-home"></i>主页</a></li>
				<li><a href="http://jitlee.github.io/blog/categories.html"><i class="fa fa-folder"></i>分类</a></li>
				<li><a href="http://jitlee.github.io/blog/tags.html"><i class="fa fa-tags"></i>标签</a></li>
				<li class="divider"></li>
				<li><a href="#"><i class="fa fa-arrow-up"></i>返回顶部</a></li>
			</ul>
		</div>

		<div class="col-sm-4 sidebar hidden-xs" id="sidebar">
			<! -- sidebar.html -->
<header class="sidebar-header" role="banner">
	<div class="sidebar-header-body">
		<a href="http://jitlee.github.io/blog">
			<img src="http://jitlee.github.io/blog/jitlee.gif" class="img-circle" />
		</a>
		<h3>
	        <a class="title" href="http://jitlee.github.io/blog">Jitlee-Wan</a>
	        <p class="role">如果你简单，这个世界就对你简单</p>
	    </h3>
	    <hr class="hr-line"/>
		<h3>
	         <p class="bio">嗨，我是万佳，一名来自深圳的js/swift开发狗，现在就职与一家互联网创业公司。</p>
	    </h3>
	    <hr class="hr-line"/>
	   <ul class="navgation navgation-primary">
	   		<li>
		       	<a id="btnblog" href="http://jitlee.github.io/blog/#post" onclick="" target="_self">博客</a>
	      	</li>
	   		<li>
		       	<a href="http://jitlee.github.io/blog/#source" target="_self">项目</a>
	      	</li>
	   		<li>
		       	<a href="http://jitlee.github.io/blog/#" target="_self">订阅</a>
	      	</li>
	   		<li>
		       	<a href="http://jitlee.github.io/blog/about.html" target="_self">关于</a>
	      	</li>
	    </ul>
	 	<ul class="navgation navgation-social">
	       	
	    		<li>
	    			<a class="github" href="http://github.com/jitlee">
	    				<i class="fa fa-github"></i>
	    			</a>
	    		</li>
	      	
	       	
	       	<li>
		      	<a class="qq" href="http://twitter.com/www.wpj@163.com">
	    				<i class="fa fa-qq"></i>
		      	</a>
		    </li>
	      	
	       	
	       	<li>
		      	<a class="weibo" href="http://twitter.com/jitlee">
	    				<i class="fa fa-weibo"></i>
		      	</a>
		    </li>
	      	
	      	
	      	<li>
		      	<a class="email" href="mailto:www.wpj@163.com">
	    				<i class="fa fa-envelope"></i>
		      	</a>
	      	</li>
	      	
	   </ul>
	</div>
</header>



<! -- sidebar.html end -->

		</div>

		<div class="col-sm-8 col-sm-offset-4" id="container">
			<div class="page-header">
	<h1>HTML5图片选剪裁择器 </h1>
</div>

<article>

	<div class="col-sm-10">
		<span class="post-date">
     2015年
     09月
     22日
      
   </span>
		<div class="article_body" id="article_body">
			<blockquote>
  <h4 id="br">功能介绍：<br /></h4>
  <p>1.支持HTML5,HTML5+使用<br />
2.支持图片不失真处理<br />
3.支持自输出图像自定义大小<br />
4.支持剪裁框自定义大小<br />
5.支持自动按照图像的EXIF的方位属性旋转<br />
6.支持图像移动、缩放和旋转等操作<br /></p>
</blockquote>

<p>效果图：</p>

<p><img src="http://jitlee.github.io/blog/assets/media/imageeditor.png" width="85%" /></p>

<p><a href="http://jitlee.github.io/demo/imageeditor.html">demo</a></p>

<p>代码如下：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**</span>
<span class="cm"> * 图片预览编辑类</span>
<span class="cm"> * @author Jitlee</span>
<span class="cm"> * @param {Object} containerId</span>
<span class="cm"> *</span>
<span class="cm"> * 接口方法：</span>
<span class="cm"> * editImage: 编辑图片</span>
<span class="cm"> * save: 保存图片</span>
<span class="cm"> * </span>
<span class="cm"> * @param {Object} containerId 图片编辑器容器ID</span>
<span class="cm"> * @param {String} aspectRatio 输出的宽高比例，默认&quot;1:1&quot;</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">ImageEditor</span><span class="p">(</span><span class="nx">containerId</span><span class="p">,</span> <span class="nx">aspectRatio</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;imageContainer&quot;</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">viewport</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">mask</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">maskContext</span> <span class="o">=</span> <span class="nx">mask</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">image</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">PREVIEW_SCALE</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">containerWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">containerHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">imageWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">imageHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">previewLeft</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">previewTop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">previewWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">previewHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">adaptImageWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">adaptImageHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">imageLeft</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">imageTop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">widthRatio</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">heightRatio</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">imageScale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">touchData</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">x1</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y1</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">x2</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">y2</span><span class="o">:</span> <span class="mi">0</span> <span class="p">};</span>
	<span class="kd">var</span> <span class="nx">MAX_SCALE</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">imageLoaded</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">browserEvents</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">rect</span><span class="p">;</span>
	
	<span class="nx">init</span><span class="p">();</span>

	<span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">aspectRatioRegex</span> <span class="o">=</span> <span class="sr">/^(\d+):(\d+)$/g</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">aspectRatioRegex</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">aspectRatio</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">widthRatio</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
			<span class="nx">heightRatio</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">matches</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
		<span class="p">}</span>
		
		<span class="nx">container</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">padding</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		
		<span class="nx">viewport</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s2">&quot;relative&quot;</span><span class="p">;</span>
		<span class="nx">viewport</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">margin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="nx">viewport</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">overflow</span> <span class="o">=</span> <span class="s2">&quot;hidden&quot;</span><span class="p">;</span>
		<span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">viewport</span><span class="p">);</span>

		<span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s2">&quot;absolute&quot;</span><span class="p">;</span>
		<span class="nx">viewport</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">canvas</span><span class="p">);</span>

		<span class="nx">mask</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s2">&quot;absolute&quot;</span><span class="p">;</span>
		<span class="nx">mask</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">&quot;100%&quot;</span><span class="p">;</span>
		<span class="nx">mask</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">&quot;100%&quot;</span><span class="p">;</span>
		<span class="nx">mask</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="nx">mask</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="nx">viewport</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">mask</span><span class="p">);</span>
		
		<span class="nx">image</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">);</span>
		<span class="nx">image</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s2">&quot;absolute&quot;</span><span class="p">;</span>
		<span class="nx">image</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">&quot;hidden&quot;</span><span class="p">;</span>
		<span class="nx">image</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">onimageload</span><span class="p">;</span>
		<span class="nx">viewport</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">image</span><span class="p">);</span>
		
		<span class="nx">updateLayout</span><span class="p">();</span>
		<span class="nx">initEvents</span><span class="p">();</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">initEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="s2">&quot;ontouchstart&quot;</span> <span class="k">in</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span> <span class="o">||</span> <span class="sr">/Mobile/ig</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">))</span> <span class="p">{</span>
			<span class="nx">browserEvents</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;touchstart&quot;</span><span class="p">,</span> <span class="s2">&quot;touchmove&quot;</span><span class="p">,</span> <span class="s2">&quot;touchend&quot;</span><span class="p">];</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">browserEvents</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mousedown&quot;</span><span class="p">,</span> <span class="s2">&quot;mousemove&quot;</span><span class="p">,</span> <span class="s2">&quot;mouseup&quot;</span><span class="p">];</span>
			<span class="nx">viewport</span><span class="p">.</span><span class="nx">onmousewheel</span> <span class="o">=</span> <span class="nx">onmousewheel</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="nx">container</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">browserEvents</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">ontouchstart</span><span class="p">);</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">ontouchstart</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">image</span><span class="p">.</span><span class="nx">src</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		
		<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">browserEvents</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">ontouchmove</span><span class="p">);</span>
		<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">browserEvents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">ontouchend</span><span class="p">);</span>
		<span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">touchData</span><span class="p">.</span><span class="nx">x2</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">pageX</span><span class="p">;</span>
				<span class="nx">touchData</span><span class="p">.</span><span class="nx">y2</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">pageY</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="nx">touchData</span><span class="p">.</span><span class="nx">x1</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pageX</span><span class="p">;</span>
			<span class="nx">touchData</span><span class="p">.</span><span class="nx">y1</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pageY</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">touchData</span><span class="p">.</span><span class="nx">x1</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">pageX</span><span class="p">;</span>
			<span class="nx">touchData</span><span class="p">.</span><span class="nx">y1</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">pageY</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">ontouchmove</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">x1</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span> <span class="o">?</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pageX</span> <span class="o">:</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">pageX</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">y1</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span> <span class="o">?</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">pageY</span> <span class="o">:</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">pageY</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">offsetX</span> <span class="o">=</span> <span class="nx">x1</span> <span class="o">-</span> <span class="nx">touchData</span><span class="p">.</span><span class="nx">x1</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">offsetY</span> <span class="o">=</span> <span class="nx">y1</span> <span class="o">-</span> <span class="nx">touchData</span><span class="p">.</span><span class="nx">y1</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span> <span class="o">&amp;&amp;</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">x2</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">pageX</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">y2</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">touches</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">pageY</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">d1</span> <span class="o">=</span> <span class="nx">getDistance</span><span class="p">(</span><span class="nx">touchData</span><span class="p">.</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">touchData</span><span class="p">.</span><span class="nx">y1</span><span class="p">,</span> <span class="nx">touchData</span><span class="p">.</span><span class="nx">x2</span><span class="p">,</span> <span class="nx">touchData</span><span class="p">.</span><span class="nx">y2</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">d2</span> <span class="o">=</span> <span class="nx">getDistance</span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">y1</span><span class="p">,</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">y2</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x2</span> <span class="o">+</span> <span class="nx">x1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y2</span> <span class="o">+</span> <span class="nx">y1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">dx</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">imageLeft</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">imageWidth</span> <span class="o">*</span> <span class="nx">imageScale</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">dy</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">imageTop</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">imageHeight</span> <span class="o">*</span> <span class="nx">imageScale</span><span class="p">);</span>
			<span class="nx">d</span> <span class="o">=</span> <span class="nx">d2</span> <span class="o">/</span> <span class="nx">d1</span><span class="p">;</span>
			
			<span class="nx">touchData</span><span class="p">.</span><span class="nx">x2</span> <span class="o">=</span> <span class="nx">x2</span><span class="p">;</span>
			<span class="nx">touchData</span><span class="p">.</span><span class="nx">y2</span> <span class="o">=</span> <span class="nx">y2</span><span class="p">;</span>
			
			<span class="nx">offsetX</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">imageLeft</span><span class="p">)</span> <span class="o">-</span> <span class="nx">imageWidth</span> <span class="o">*</span> <span class="nx">imageScale</span> <span class="o">*</span> <span class="nx">d</span> <span class="o">*</span> <span class="nx">dx</span><span class="p">;</span>
			<span class="nx">offsetY</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">imageTop</span><span class="p">)</span> <span class="o">-</span> <span class="nx">imageHeight</span> <span class="o">*</span> <span class="nx">imageScale</span> <span class="o">*</span> <span class="nx">d</span> <span class="o">*</span> <span class="nx">dy</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">imageScale</span> <span class="o">*</span> <span class="nx">d</span> <span class="o">&lt;</span> <span class="nx">MAX_SCALE</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">scale</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="nx">touchData</span><span class="p">.</span><span class="nx">x1</span> <span class="o">=</span> <span class="nx">x1</span><span class="p">;</span>
		<span class="nx">touchData</span><span class="p">.</span><span class="nx">y1</span> <span class="o">=</span> <span class="nx">y1</span><span class="p">;</span>
		<span class="nx">move</span><span class="p">(</span><span class="nx">offsetX</span><span class="p">,</span> <span class="nx">offsetY</span><span class="p">);</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">ontouchend</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
		<span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">browserEvents</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">ontouchmove</span><span class="p">);</span>
		<span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">browserEvents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">ontouchend</span><span class="p">);</span>
		<span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">onmousewheel</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">dx</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">imageLeft</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">imageWidth</span> <span class="o">*</span> <span class="nx">imageScale</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">dy</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">imageTop</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">imageHeight</span> <span class="o">*</span> <span class="nx">imageScale</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">delta</span> <span class="o">=</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">wheelDelta</span> <span class="o">||</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">detail</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">delta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">d</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">d</span> <span class="o">=</span> <span class="mf">1.25</span><span class="p">;</span>
		<span class="p">}</span>
		
		<span class="kd">var</span> <span class="nx">offsetX</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">imageLeft</span><span class="p">)</span> <span class="o">-</span> <span class="nx">imageWidth</span> <span class="o">*</span> <span class="nx">imageScale</span> <span class="o">*</span> <span class="nx">d</span> <span class="o">*</span> <span class="nx">dx</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">offsetY</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">imageTop</span><span class="p">)</span> <span class="o">-</span> <span class="nx">imageHeight</span> <span class="o">*</span> <span class="nx">imageScale</span> <span class="o">*</span> <span class="nx">d</span> <span class="o">*</span> <span class="nx">dy</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">imageScale</span> <span class="o">*</span> <span class="nx">d</span> <span class="o">&lt;</span> <span class="nx">MAX_SCALE</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">scale</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
			<span class="nx">move</span><span class="p">(</span><span class="nx">offsetX</span><span class="p">,</span> <span class="nx">offsetY</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">getDistance</span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">y1</span><span class="p">,</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">y2</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">x1</span> <span class="o">-</span> <span class="nx">x2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">x1</span><span class="o">-</span> <span class="nx">x2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y1</span> <span class="o">-</span> <span class="nx">y2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">y1</span> <span class="o">-</span> <span class="nx">y2</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">updateLayout</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">rect</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
		<span class="nx">containerWidth</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
		<span class="nx">containerHeight</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
		<span class="nx">viewport</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
		<span class="nx">viewport</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">containerHeight</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
		<span class="nx">previewWidth</span> <span class="o">=</span> <span class="nx">containerWidth</span> <span class="o">*</span> <span class="nx">PREVIEW_SCALE</span><span class="p">;</span>
		<span class="nx">previewHeight</span> <span class="o">=</span> <span class="nx">containerHeight</span> <span class="o">*</span> <span class="nx">PREVIEW_SCALE</span><span class="p">;</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nx">widthRatio</span> <span class="o">/</span> <span class="nx">heightRatio</span> <span class="o">&gt;</span> <span class="nx">containerWidth</span> <span class="o">/</span> <span class="nx">containerHeight</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">previewHeight</span> <span class="o">=</span> <span class="nx">previewWidth</span> <span class="o">*</span> <span class="nx">heightRatio</span> <span class="o">/</span> <span class="nx">widthRatio</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">previewWidth</span> <span class="o">=</span> <span class="nx">previewHeight</span> <span class="o">*</span> <span class="nx">widthRatio</span> <span class="o">/</span> <span class="nx">heightRatio</span><span class="p">;</span>
		<span class="p">}</span>
		
		<span class="nx">previewLeft</span> <span class="o">=</span> <span class="p">(</span><span class="nx">containerWidth</span> <span class="o">-</span> <span class="nx">previewWidth</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">;</span>
		<span class="nx">previewTop</span> <span class="o">=</span> <span class="p">(</span><span class="nx">containerHeight</span> <span class="o">-</span> <span class="nx">previewHeight</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">;</span>
		
		<span class="nx">updateMaskLayout</span><span class="p">();</span>
		<span class="nx">updateImageLayout</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">updateImageLayout</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">image</span><span class="p">.</span><span class="nx">src</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		
		<span class="nx">imageWidth</span> <span class="o">=</span> <span class="nx">imageWidth</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">imageWidth</span> <span class="o">:</span> <span class="nx">image</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">;</span>
		<span class="nx">imageHeight</span> <span class="o">=</span> <span class="nx">imageHeight</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">imageHeight</span> <span class="o">:</span> <span class="nx">image</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">;</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span>	<span class="p">(</span><span class="s2">&quot;图片尺寸：&quot;</span> <span class="o">+</span> <span class="nx">imageWidth</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="nx">imageHeight</span><span class="p">);</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nx">imageWidth</span> <span class="o">/</span> <span class="nx">imageHeight</span> <span class="o">&gt;</span> <span class="nx">previewWidth</span> <span class="o">/</span> <span class="nx">previewHeight</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">adaptImageHeight</span> <span class="o">=</span> <span class="nx">previewHeight</span><span class="p">;</span>
			<span class="nx">adaptImageWidth</span> <span class="o">=</span> <span class="nx">adaptImageHeight</span> <span class="o">*</span> <span class="nx">imageWidth</span> <span class="o">/</span> <span class="nx">imageHeight</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">adaptImageWidth</span> <span class="o">=</span> <span class="nx">previewWidth</span><span class="p">;</span>
			<span class="nx">adaptImageHeight</span> <span class="o">=</span> <span class="nx">adaptImageWidth</span> <span class="o">*</span> <span class="nx">imageHeight</span> <span class="o">/</span> <span class="nx">imageWidth</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="nx">imageLeft</span> <span class="o">=</span> <span class="p">(</span><span class="nx">containerWidth</span> <span class="o">-</span> <span class="nx">adaptImageWidth</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">;</span>
		<span class="nx">imageTop</span> <span class="o">=</span> <span class="p">(</span><span class="nx">containerHeight</span> <span class="o">-</span> <span class="nx">adaptImageHeight</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">;</span>
		<span class="nx">imageScale</span> <span class="o">=</span> <span class="nx">adaptImageWidth</span> <span class="o">/</span> <span class="nx">imageWidth</span><span class="p">;</span>
		
		<span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">imageWidth</span><span class="p">;</span>
		<span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">imageHeight</span><span class="p">;</span>
		<span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">adaptImageWidth</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
		<span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">adaptImageHeight</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
		<span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">imageLeft</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
		<span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">imageTop</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">matrix</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">matrix</span><span class="p">;</span>
			<span class="nx">context</span><span class="p">.</span><span class="nx">setTransform</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="nx">m</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
		<span class="p">}</span>
		<span class="nx">renderImage</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">updateMaskLayout</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">mask</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">containerWidth</span><span class="p">;</span>
		<span class="nx">mask</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">containerHeight</span><span class="p">;</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="mf">0.55</span><span class="p">;</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">mask</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">mask</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;#000000&quot;</span><span class="p">;</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">mask</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">mask</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="nx">previewLeft</span><span class="p">,</span> <span class="nx">previewTop</span><span class="p">,</span> <span class="nx">previewWidth</span><span class="p">,</span> <span class="nx">previewHeight</span><span class="p">);</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">globalAlpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">;</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">strokeRect</span><span class="p">(</span><span class="nx">previewLeft</span><span class="p">,</span> <span class="nx">previewTop</span><span class="p">,</span> <span class="nx">previewWidth</span><span class="p">,</span> <span class="nx">previewHeight</span><span class="p">);</span>
		<span class="nx">maskContext</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">onimageload</span><span class="p">()</span> <span class="p">{</span>	
		<span class="k">if</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">orientation</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">adjustment</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">orientation</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nx">updateImageLayout</span><span class="p">();</span>
		<span class="nx">imageLoaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">renderImage</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">context</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
		<span class="nx">context</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">move</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">imageLeft</span> <span class="o">+=</span> <span class="nx">x</span><span class="p">;</span>
		<span class="nx">imageTop</span> <span class="o">+=</span> <span class="nx">y</span><span class="p">;</span>
		<span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">imageLeft</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
		<span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">imageTop</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">scale</span><span class="p">(</span><span class="nx">scale</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">imageScale</span> <span class="o">*=</span> <span class="nx">scale</span><span class="p">;</span>
		<span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">imageWidth</span> <span class="o">*</span> <span class="nx">imageScale</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
		<span class="nx">canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">imageHeight</span> <span class="o">*</span> <span class="nx">imageScale</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">getorientation</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getOrientation</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">// custom get orientation of image </span>
			<span class="nx">self</span><span class="p">.</span><span class="nx">getOrientation</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">orientation</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="nx">http</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">dataview</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DataView</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">response</span><span class="p">);</span>
                    <span class="kd">var</span> <span class="kr">byte</span><span class="p">;</span>
                    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">;</span> <span class="nx">i</span><span class="o">+=</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                    		<span class="kr">byte</span> <span class="o">=</span> <span class="nx">dataview</span><span class="p">.</span><span class="nx">getInt16</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
                    		<span class="k">if</span><span class="p">(</span><span class="kr">byte</span> <span class="o">==</span> <span class="mh">0x1201</span><span class="p">)</span> <span class="p">{</span>
                    			<span class="nx">orientation</span> <span class="o">=</span> <span class="nx">dataview</span><span class="p">.</span><span class="nx">getInt8</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
                    			<span class="k">break</span><span class="p">;</span>
                    		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="kr">byte</span> <span class="o">==</span> <span class="mh">0x0112</span><span class="p">)</span> <span class="p">{</span>
                    			<span class="nx">orientation</span> <span class="o">=</span> <span class="nx">dataview</span><span class="p">.</span><span class="nx">getInt8</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">9</span><span class="p">);</span>
                    			<span class="k">break</span><span class="p">;</span>
                    		<span class="p">}</span>
                    <span class="p">}</span>
                    <span class="nx">callback</span><span class="p">(</span><span class="nx">orientation</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">callback</span><span class="p">(</span><span class="nx">orientation</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">http</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">};</span>
            <span class="nx">http</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="nx">http</span><span class="p">.</span><span class="nx">responseType</span> <span class="o">=</span> <span class="s2">&quot;arraybuffer&quot;</span><span class="p">;</span>
            <span class="nx">http</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">adjustment</span><span class="p">(</span><span class="nx">orientation</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="nx">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="nx">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="nx">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="nx">e</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="nx">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">w</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">,</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="nx">orientation</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
				<span class="nx">a</span> <span class="o">=</span> <span class="nx">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
				<span class="nx">a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
				<span class="nx">a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
				<span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">d</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
				<span class="nx">b</span> <span class="o">=</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">6</span><span class="o">:</span>
				<span class="nx">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">c</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">7</span><span class="o">:</span>
				<span class="nx">b</span> <span class="o">=</span> <span class="nx">c</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">8</span><span class="o">:</span>
				<span class="nx">b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">default</span><span class="o">:</span>
				<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">orientation</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">imageWidth</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span>
			<span class="nx">imageHeight</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="nx">image</span><span class="p">.</span><span class="nx">matrix</span> <span class="o">=</span> <span class="p">[</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">f</span><span class="p">];</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">isIOS</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="sr">/(ipad)|(iphone)/ig</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">)</span>
	<span class="p">}</span>
	
	<span class="nx">self</span><span class="p">.</span><span class="nx">edit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">adjust</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">imageWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="nx">imageHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="nx">imageLoaded</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
		<span class="nx">context</span><span class="p">.</span><span class="nx">setTransform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
		<span class="nx">image</span><span class="p">.</span><span class="nx">matrix</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
		<span class="nx">image</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nx">adjust</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isIOS</span><span class="p">())</span> <span class="p">{</span>
			<span class="nx">getorientation</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span>  <span class="kd">function</span><span class="p">(</span><span class="nx">orientation</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;图片方位：&quot;</span> <span class="o">+</span> <span class="nx">orientation</span><span class="p">);</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">imageLoaded</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">adjustment</span><span class="p">(</span><span class="nx">orientation</span><span class="p">);</span>
					<span class="nx">updateImageLayout</span><span class="p">();</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="nx">image</span><span class="p">.</span><span class="nx">orientation</span> <span class="o">=</span> <span class="nx">orientation</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">}</span>
	
	<span class="nx">self</span><span class="p">.</span><span class="nx">clip</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="nx">width</span> <span class="o">||</span> <span class="nx">imageWidth</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">height</span> <span class="o">||</span> <span class="nx">width</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">_canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">_context</span> <span class="o">=</span> <span class="nx">_canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">_scale</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">width</span> <span class="o">/</span> <span class="nx">imageWidth</span><span class="p">,</span> <span class="nx">height</span> <span class="o">/</span> <span class="nx">imageHeight</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">_scale</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">_scale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="kd">var</span> <span class="nx">_width</span> <span class="o">=</span> <span class="nx">imageWidth</span> <span class="o">*</span> <span class="nx">_scale</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">_height</span> <span class="o">=</span> <span class="nx">imageHeight</span> <span class="o">*</span> <span class="nx">_scale</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">_left</span> <span class="o">=</span> <span class="p">(</span><span class="nx">previewLeft</span> <span class="o">-</span> <span class="nx">imageLeft</span><span class="p">)</span> <span class="o">/</span> <span class="nx">imageScale</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">_top</span> <span class="o">=</span> <span class="p">(</span><span class="nx">previewTop</span> <span class="o">-</span> <span class="nx">imageTop</span><span class="p">)</span> <span class="o">/</span> <span class="nx">imageScale</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">_width</span> <span class="o">/</span> <span class="nx">_height</span> <span class="o">&gt;</span> <span class="nx">previewWidth</span> <span class="o">/</span> <span class="nx">previewHeight</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">_width</span> <span class="o">=</span> <span class="nx">_height</span> <span class="o">*</span> <span class="nx">previewWidth</span> <span class="o">/</span> <span class="nx">previewHeight</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">_height</span> <span class="o">=</span> <span class="nx">_width</span> <span class="o">*</span> <span class="nx">previewHeight</span> <span class="o">/</span> <span class="nx">previewWidth</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="nx">_scale</span> <span class="o">/=</span> <span class="p">(</span><span class="nx">adaptImageWidth</span> <span class="o">/</span> <span class="nx">imageScale</span><span class="p">)</span> <span class="o">/</span> <span class="nx">imageWidth</span><span class="p">;</span>
		
		<span class="nx">_canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">_width</span><span class="p">;</span>
		<span class="nx">_canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">_height</span><span class="p">;</span>
		<span class="nx">_canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">_width</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
		<span class="nx">_canvas</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">_height</span> <span class="o">+</span> <span class="s2">&quot;px&quot;</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">matrix</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">matrix</span><span class="p">;</span>
			<span class="nx">_context</span><span class="p">.</span><span class="nx">setTransform</span><span class="p">(</span><span class="nx">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nx">_scale</span> <span class="p">,</span><span class="nx">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nx">_scale</span><span class="p">,</span><span class="nx">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="nx">_scale</span><span class="p">,</span><span class="nx">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="nx">_scale</span><span class="p">,(</span><span class="nx">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="nx">_left</span><span class="p">)</span> <span class="o">*</span> <span class="nx">_scale</span><span class="p">,(</span><span class="nx">m</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="nx">_top</span><span class="p">)</span> <span class="o">*</span> <span class="nx">_scale</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nx">_context</span><span class="p">.</span><span class="nx">setTransform</span><span class="p">(</span><span class="nx">_scale</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">_scale</span><span class="p">,</span><span class="o">-</span><span class="nx">_left</span> <span class="o">*</span> <span class="nx">_scale</span><span class="p">,</span><span class="o">-</span><span class="nx">_top</span> <span class="o">*</span> <span class="nx">_scale</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nx">_context</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">return</span> <span class="nx">_canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="s2">&quot;data:image/jpg&quot;</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></div>

<hr />

<p><span style="color:red">旋转接口未完待续。。。</span>（其实功能已完成，没有写对外接口）&lt;/font&gt;</p>

		</div>

		
		<ul class="tag_box list-unstyled list-inline">
			<li><i class="fa fa-folder-open"></i></li>
			  
			<li><a href="http://jitlee.github.io/blog/categories.html#html5-ref">
          html5 <span>(2)</span>
          
        </a></li>
			 
		</ul>
		 
		<ul class="list-inline">
			<li><i class="fa fa-tags"></i></li>
			  
			<li>
				<a href="http://jitlee.github.io/blog/tags.html#HTML5-ref">
          HTML5 <span>(1)</span>
          ,
          </a>
			</li>
			
			<li>
				<a href="http://jitlee.github.io/blog/tags.html#HTML5+-ref">
          HTML5+ <span>(1)</span>
          ,
          </a>
			</li>
			
			<li>
				<a href="http://jitlee.github.io/blog/tags.html#Javascript-ref">
          Javascript <span>(1)</span>
          ,
          </a>
			</li>
			
			<li>
				<a href="http://jitlee.github.io/blog/tags.html#Canvas-ref">
          Canvas <span>(2)</span>
          ,
          </a>
			</li>
			
			<li>
				<a href="http://jitlee.github.io/blog/tags.html#Image-ref">
          Image <span>(1)</span>
          ,
          </a>
			</li>
			
			<li>
				<a href="http://jitlee.github.io/blog/tags.html#移动开发-ref">
          移动开发 <span>(1)</span>
          
          </a>
			</li>
			  
		</ul>
		

		<hr>

		<div>
			<section class="share col-sm-6">
				<h4 class="section-title">分享</h4>
				<a class="btn btn-default btn-sm twitter" href="javascript:void(0);">
					<i class="fa fa-weibo fa-lg"></i> 微博
				</a>
				<a class="btn btn-default btn-sm facebook" href="javascript:void(0);">
					<i class="fa fa-weixin fa-lg"></i> 微信
				</a>
			</section>

			<section class="col-sm-6 author">
				<img src="http://jitlee.github.io/blog/jitlee.gif" style="height:100px;width:100px;" class="img-rounded author-image" />
				<h4 class="section-title author-name"><b>Jitlee-Wan</b><br/><p style="color:#888;font-size:13px;">如果你简单，这个世界就对你简单</p></h4>
				<p class="author-bio">嗨，我是万佳，一名来自深圳的js/swift开发狗，现在就职与一家互联网创业公司。</p>
			</section>
		</div>

		<div class="clearfix"></div>

		<ul class="pager">
			
			<li class="previous"><a href="http://jitlee.github.io/blog/the-keywords-in-javascript" title="JavaScript之关键字this">&larr; 上一篇</a></li>
			 
			<li class="next"><a href="http://jitlee.github.io/blog/html5-canvas-designer" title="HTML5之基于Canvas打造2D设计器">下一篇 &rarr;</a></li>
			
		</ul>

	</div>

	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/html5-image-editor" data-title="HTML5图片选剪裁择器" data-url=""/html5-image-editor></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"jitlee"};
		(function() {
			var ds = document.createElement('script');
			ds.type = 'text/javascript';ds.async = true;
			ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
			ds.charset = 'UTF-8';
			(document.getElementsByTagName('head')[0] 
			 || document.getElementsByTagName('body')[0]).appendChild(ds);
		})();
		</script>
	<!-- 多说公共JS代码 end -->

</article>
<div class="clearfix"></div>

			<footer class="navbar navbar-default">
				<div class="container">
					<p class="navbar-text pull-left">&copy; 2015 Jitlee.Wan
						基于 <a class="navbar-button" href="https://pages.github.com/">Github Pages</a> 搭建
						采用<a class="navbar-button" href="https://github.com/twbs/bootstrap">Bootstrap3</a> 和 <a class="navbar-button" href="https://github.com/jekyll/jekyll">Jekyll</a> 技术
						感谢talk2ankan提供的<a class="navbar-button" href="https://github.com/talk2ankan/uno-dbyll">uno-dbyll</a> 主题和 <a class="navbar-button" href="http://duoshuo.com/">多说</a>提供的评论系统
						最重要的是感谢我最亲爱的老婆<b>zoey</b>
					</p>
				</div>
			</footer>
		</div>
	</body>

</html>