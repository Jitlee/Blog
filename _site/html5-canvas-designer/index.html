<!DOCTYPE html>
<html lang="ch-cn">

	<head>
		<title>HTML5之基于Canvas打造2D设计器</title>
		<meta charset="utf-8" /> 
		<meta name="description" content="使用Canvas的最基本功能，创建复杂的控件和完美的设计器。基于Javascript面向对象的设计，提升框架的可扩展性、易用性"> 
		<meta name="author" content="Jitlee.Wan">

		<!-- Enable responsive viewport -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="http://jitlee.github.io/blog/assets/css/style.css">
		<link rel="stylesheet" type="text/css" href="http://jitlee.github.io/blog/assets/resources/syntax/syntax.css">
		<link rel="stylesheet" type="text/css" href="http://jitlee.github.io/blog/assets/resources/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="http://jitlee.github.io/blog/assets/resources/font-awesome/css/font-awesome.min.css">
		<link rel="shortcut icon" href="http://jitlee.github.io/blog/assets/ico/favicon.png">

		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script type="text/javascript" src="http://jitlee.github.io/blog/assets/resources/bootstrap/js/bootstrap.js"></script>

		<script type="text/javascript">
			$(document).ready(function(){
				if(window.location.href.replace(/\/$/g, "")=="http://jitlee.github.io/blog") {
					$("#sidebar").css({width:'100%'});
					$("#btnblog").click(function(){
						$("#sidebar").animate({width:'33.3333%'},'slow');
					});
				}
			});
		</script>
	</head>

	<body>
		<nav class="navbar navbar-default visible-xs" role="navigation">

			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbarHeaderCollapse">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				
				<a type="button" class="navbar-toggle nav-link" href="http://github.com/jitlee">
					<i class="fa fa-github"></i>
				</a>
				 
				<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/www.wpj@163.com">
					<i class="fa fa-qq"></i>
				</a>
				 
				<a type="button" class="navbar-toggle nav-link" href="http://twitter.com/jitlee">
					<i class="fa fa-weibo"></i>
				</a>
				 
				<a type="button" class="navbar-toggle nav-link" href="mailto:www.wpj@163.com">
					<i class="fa fa-envelope"></i>
				</a>
				

				<a class="navbar-brand" href="http://jitlee.github.io/blog">
					<img src="http://jitlee.github.io/blog/jitlee.gif" class="img-circle img-circle-small"/> Jitlee-Wan
				</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="navbarHeaderCollapse">
				<ul class="nav navbar-nav">
					<li class="active"><a href="http://jitlee.github.io/blog">主页</a></li>
					<li><a href="http://jitlee.github.io/blog/categories.html">分类</a></li>
					<li><a href="http://jitlee.github.io/blog/tags.html">标签</a></li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->

		</nav>

		<!-- nav-menu-dropdown -->
		<div class="btn-group hidden-xs" id="nav-menu">
			<button type="button" class="btn btn-default dropdown-toggle pull-right" data-toggle="dropdown">
				<i class="fa fa-bars"></i>
			</button>
			<ul class="dropdown-menu pull-right" role="menu">
				<li><a href="http://jitlee.github.io/blog"><i class="fa fa-home"></i>主页</a></li>
				<li><a href="http://jitlee.github.io/blog/categories.html"><i class="fa fa-folder"></i>分类</a></li>
				<li><a href="http://jitlee.github.io/blog/tags.html"><i class="fa fa-tags"></i>标签</a></li>
				<li class="divider"></li>
				<li><a href="#"><i class="fa fa-arrow-up"></i>返回顶部</a></li>
			</ul>
		</div>

		<div class="col-sm-4 sidebar hidden-xs" id="sidebar">
			<! -- sidebar.html -->
<header class="sidebar-header" role="banner">
	<div class="sidebar-header-body">
		<a href="http://jitlee.github.io/blog">
			<img src="http://jitlee.github.io/blog/jitlee.gif" class="img-circle" />
		</a>
		<h3>
	        <a class="title" href="http://jitlee.github.io/blog">Jitlee-Wan</a>
	        <p class="role">如果你简单，这个世界就对你简单</p>
	    </h3>
	    <hr class="hr-line"/>
		<h3>
	         <p class="bio">嗨，我是万佳，一名来自深圳的js/swift开发狗，现在就职与一家互联网创业公司。</p>
	    </h3>
	    <hr class="hr-line"/>
	   <ul class="navgation navgation-primary">
	   		<li>
		       	<a id="btnblog" href="http://jitlee.github.io/blog/#post" onclick="" target="_self">博客</a>
	      	</li>
	   		<li>
		       	<a href="http://jitlee.github.io/blog/#source" target="_self">项目</a>
	      	</li>
	   		<li>
		       	<a href="http://jitlee.github.io/blog/#" target="_self">订阅</a>
	      	</li>
	   		<li>
		       	<a href="http://jitlee.github.io/blog/about.html" target="_self">关于</a>
	      	</li>
	    </ul>
	 	<ul class="navgation navgation-social">
	       	
	    		<li>
	    			<a class="github" href="http://github.com/jitlee">
	    				<i class="fa fa-github"></i>
	    			</a>
	    		</li>
	      	
	       	
	       	<li>
		      	<a class="qq" href="http://twitter.com/www.wpj@163.com">
	    				<i class="fa fa-qq"></i>
		      	</a>
		    </li>
	      	
	       	
	       	<li>
		      	<a class="weibo" href="http://twitter.com/jitlee">
	    				<i class="fa fa-weibo"></i>
		      	</a>
		    </li>
	      	
	      	
	      	<li>
		      	<a class="email" href="mailto:www.wpj@163.com">
	    				<i class="fa fa-envelope"></i>
		      	</a>
	      	</li>
	      	
	   </ul>
	</div>
</header>



<! -- sidebar.html end -->

		</div>

		<div class="col-sm-8 col-sm-offset-4" id="container">
			<div class="page-header">
	<h1>HTML5之基于Canvas打造2D设计器 </h1>
</div>

<article>

	<div class="col-sm-10">
		<span class="post-date">
     2015年
     10月
     15日
      
   </span>
		<div class="article_body" id="article_body">
			<blockquote>
  <p>前几年帮一朋友把一款Winform的程序，做成Silverlight版，再后来又改造成WPF版的。
现在说要做HTML5版的，没办法继续折腾吧！</p>
</blockquote>

<p>[demo] (http://jitlee.github.io/demo/monitor.html)</p>

<p><em>由于商业原因，本文演示的DEMO和功能并不包含全部的项目内容</em></p>

<p><em>本文的设计思想是完全仿照<a href="http://openlayers.org/two/">OpenLayer2.0</a>，如有不当之处，敬请批评指正</em></p>

<h3 id="javascript">1.实现Javascript的面向对象功能</h3>

<p>我的底层代码依然使用OpenLayers的，分别用到了：
- OpenLayers.BaseTypes.js
- OpenLayers.Class.js
- OpenLayers.Element.js
- OpenLayers.Util.js
- OpenLayers.Monitor.js
- OpenLayers.Handler.js
- OpenLayers.Handler.Drag.js</p>

<p>下面两段代码分别实现了类(Class)和继承(inherit)：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">Monitor</span><span class="p">.</span><span class="nx">Class</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">P</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">F</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">len</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">C</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">F</span><span class="p">.</span><span class="nx">init</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span> <span class="o">?</span>
        <span class="nx">F</span><span class="p">.</span><span class="nx">init</span> <span class="o">:</span>
        <span class="kd">function</span><span class="p">(){</span> <span class="nx">P</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span> <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">len</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">newArgs</span> <span class="o">=</span> <span class="p">[</span><span class="nx">C</span><span class="p">,</span> <span class="nx">P</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span>
                <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">len</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nx">F</span><span class="p">);</span>
        <span class="nx">Monitor</span><span class="p">.</span><span class="nx">inherit</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">newArgs</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">F</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">C</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Monitor</span><span class="p">.</span><span class="nx">inherit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">C</span><span class="p">,</span> <span class="nx">P</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">F</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{};</span>
	<span class="nx">F</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">P</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
	<span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">F</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">o</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">o</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
	    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
	    		<span class="nx">o</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="nx">Monitor</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">C</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">o</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></div>

<h3 id="map">2.创建Map对象</h3>

<p>Map.js在OpenLayers中，原本是地图容器。由于我要打造设计器并不是地图，
所以不需要做那么复杂的地理信息处理。除了以上代码大部分采用OpenLayers原封代码外，
以下代码都是简单的设计下。</p>

<h3 id="section">3.创建图层基类和矢量图层类</h3>

<p>矢量图层实际是一张画布，一个设计器需要多层画布。类似与PS中的层的概念。</p>

<h3 id="section-1">4.创建修改控件类</h3>

<p>使用Drag.js实现对控件的移动和缩放功能</p>

<h3 id="renderer">5.创建Renderer类</h3>

<p>OpenLayers原本</p>


		</div>

		
		<ul class="tag_box list-unstyled list-inline">
			<li><i class="fa fa-folder-open"></i></li>
			  
			<li><a href="http://jitlee.github.io/blog/categories.html#html5-ref">
          html5 <span>(2)</span>
          
        </a></li>
			 
		</ul>
		 
		<ul class="list-inline">
			<li><i class="fa fa-tags"></i></li>
			  
			<li>
				<a href="http://jitlee.github.io/blog/tags.html#Canvas-ref">
          Canvas <span>(2)</span>
          ,
          </a>
			</li>
			
			<li>
				<a href="http://jitlee.github.io/blog/tags.html#JS-ref">
          JS <span>(1)</span>
          ,
          </a>
			</li>
			
			<li>
				<a href="http://jitlee.github.io/blog/tags.html#面向对象，设计器-ref">
          面向对象，设计器 <span>(1)</span>
          
          </a>
			</li>
			  
		</ul>
		

		<hr>

		<div>
			<section class="share col-sm-6">
				<h4 class="section-title">分享</h4>
				<a class="btn btn-default btn-sm twitter" href="javascript:void(0);">
					<i class="fa fa-weibo fa-lg"></i> 微博
				</a>
				<a class="btn btn-default btn-sm facebook" href="javascript:void(0);">
					<i class="fa fa-weixin fa-lg"></i> 微信
				</a>
			</section>

			<section class="col-sm-6 author">
				<img src="http://jitlee.github.io/blog/jitlee.gif" style="height:100px;width:100px;" class="img-rounded author-image" />
				<h4 class="section-title author-name"><b>Jitlee-Wan</b><br/><p style="color:#888;font-size:13px;">如果你简单，这个世界就对你简单</p></h4>
				<p class="author-bio">嗨，我是万佳，一名来自深圳的js/swift开发狗，现在就职与一家互联网创业公司。</p>
			</section>
		</div>

		<div class="clearfix"></div>

		<ul class="pager">
			
			<li class="previous"><a href="http://jitlee.github.io/blog/html5-image-editor" title="HTML5图片选剪裁择器">&larr; 上一篇</a></li>
			 
			<li class="next disabled"><a>下一篇 &rarr;</a> 
		</ul>

	</div>

	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/html5-canvas-designer" data-title="HTML5之基于Canvas打造2D设计器" data-url=""/html5-canvas-designer></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"jitlee"};
		(function() {
			var ds = document.createElement('script');
			ds.type = 'text/javascript';ds.async = true;
			ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
			ds.charset = 'UTF-8';
			(document.getElementsByTagName('head')[0] 
			 || document.getElementsByTagName('body')[0]).appendChild(ds);
		})();
		</script>
	<!-- 多说公共JS代码 end -->

</article>
<div class="clearfix"></div>

			<footer class="navbar navbar-default">
				<div class="container">
					<p class="navbar-text pull-left">&copy; 2015 Jitlee.Wan
						基于 <a class="navbar-button" href="https://pages.github.com/">Github Pages</a> 搭建
						采用<a class="navbar-button" href="https://github.com/twbs/bootstrap">Bootstrap3</a> 和 <a class="navbar-button" href="https://github.com/jekyll/jekyll">Jekyll</a> 技术
						感谢talk2ankan提供的<a class="navbar-button" href="https://github.com/talk2ankan/uno-dbyll">uno-dbyll</a> 主题和 <a class="navbar-button" href="http://duoshuo.com/">多说</a>提供的评论系统
						最重要的是感谢我最亲爱的老婆<b>zoey</b>
					</p>
				</div>
			</footer>
		</div>
	</body>

</html>